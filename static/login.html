<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AutoPub • Connexion</title>
  <style>
    :root{--bg:#fff9fc;--panel:#fff;--accent:#ff6aa2;--accent2:#9a70ff;--text:#2a2a2a;--muted:#6b6b6b;--border:#f1d7e3;--shadow:0 10px 30px rgba(255,106,162,.12);--radius:16px;}
    *{box-sizing:border-box}body{margin:0;background:var(--bg);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:var(--text)}
    .wrap{max-width:560px;margin:48px auto;padding:0 16px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:24px}
    h1{margin:0 0 16px 0;font-size:24px}
    label{display:block;font-size:13px;color:var(--muted);margin:10px 0 6px}
    input{width:100%;padding:12px;border:1px solid #eee;border-radius:12px}
    button{border:0;background:var(--accent);color:#fff;padding:12px 16px;border-radius:12px;font-weight:700;cursor:pointer;box-shadow:var(--shadow)}
    .row{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-top:14px}
    .muted{color:var(--muted);font-size:12px}
    .logo{width:48px;height:48px;border-radius:14px;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:var(--shadow);margin-bottom:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="logo"></div>
      <h1>AutoPub — Connexion</h1>

      <div>
        <label>Email</label>
        <input id="email" type="email" placeholder="toi@mail.com">

        <label>Mot de passe</label>
        <input id="pass" type="password" placeholder="••••••••">

        <div class="row">
          <label class="muted"><input id="remember" type="checkbox"> Rester connecté(e)</label>
          <button onclick="doLogin()">Se connecter</button>
        </div>
      </div>

      <hr style="margin:20px 0;border:none;border-top:1px solid #f3e3ec">
      <div class="muted">Pas de compte ?</div>

      <div class="row">
        <span class="muted">Crée un compte en 2 secondes :</span>
        <button style="background:#f3e9ff;color:#5339a6" onclick="doRegister()">Créer un compte</button>
      </div>
    </div>
  </div>

  <script>
    const API = location.origin;
    let token = localStorage.getItem('token')||'';

    if(token){
      // déjà connecté → va directement au dashboard
      location.replace('/dashboard');
    }

    function $(id){return document.getElementById(id)}

    async function doRegister(){
      const email=$('email').value.trim(), password=$('pass').value, remember=$('remember').checked;
      if(!email||!password){ alert('Email et mot de passe requis'); return;}
      try{
        const r=await fetch(`${API}/auth/register`,{
          method:'POST', headers:{'Content-Type':'application/json'},
          body:JSON.stringify({email,password,remember})
        });
        if(!r.ok){ const t=await r.json(); throw new Error(t.detail||'Inscription refusée'); }
        const t=await r.json(); localStorage.setItem('token', t.access_token);
        location.replace('/dashboard');
      }catch(e){ alert(e.message); }
    }

    async function doLogin(){
      const email=$('email').value.trim(), password=$('pass').value, remember=$('remember').checked;
      if(!email||!password){ alert('Email et mot de passe requis'); return;}
      try{
        const r=await fetch(`${API}/auth/login`,{
          method:'POST', headers:{'Content-Type':'application/json'},
          body:JSON.stringify({email,password,remember})
        });
        if(!r.ok){ const t=await r.json(); throw new Error(t.detail||'Connexion refusée'); }
        const t=await r.json(); localStorage.setItem('token', t.access_token);
        location.replace('/dashboard');
      }catch(e){ alert(e.message); }
    }
  </script>
</body>
</html>
